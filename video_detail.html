<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>宫崎骏热门电影</title>
    <meta name="description" content="Roxy">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Fonts -->
    <link rel="stylesheet" href="css/icon-font.css">
    <!--<link href="https://fonts.googleapis.com/css?family=Lato:300,400|Work+Sans:300,400,700" rel="stylesheet">-->

    <!-- CSS -->
    <link rel="stylesheet" href="vendor/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.min.css">
    <link rel="stylesheet" href="css/video/video_detail.css">
    <style type="text/css">

        canvas {
            position: absolute;
            top: 0;
            z-index: 1;
        }

        * {
            margin: 0;
            padding: 0;
        }

        body {
            background-repeat: repeat-x;
            background-position: bottom center;
            background-image: url(./img/video_detail/winterForest.png);
            background-color: #133D7C !important;
        }

        #canvas {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            margin: auto;
        }

    </style>

    <!-- Modernizr JS for IE8 support of HTML5 elements and media queries -->
    <script src="js/modernizr.js"></script>
</head>

<body data-spy="scroll" data-target="#navbar" class="static-layout" style="background-color: rgb(236, 240, 249);">
<div class="container">
    <div class="title">
        <div class="return">
            <a href="./video.html">
                <img src="./img/icons/return.png" alt="" style="width: 40px;">
            </a>
        </div>
        <h2 class="heading" id="heading">Custom HTML5 Video Player with Ckins...</h2>
    </div>
    <video poster="" src="" data-ckin="default" data-overlay="1" id="video"></video>
</div>

<!--背景动画 -->
<canvas id="canvas"></canvas>

<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="./js/video.js"></script>
<script type="text/javascript" src="./js/data.js"></script>
<script src="./js/cursor/cursor-effects.js"></script>
<script>
    function my$(id) {
        return document.getElementById(id);
    }

    //讲当前秒数转换为时间
    function getTimeBySecond(second) {
        let hour = parseInt(second / (60 * 60));
        let minute = parseInt((second / 60) % 60);
        let newSecond = parseInt(second % 60);
        return (hour < 10 ? "0" + hour : hour) + ":" + (minute < 10 ? "0" + minute : minute) + ":" + (newSecond < 10 ? "0" + newSecond : newSecond);
    }

    // 获取数据
    // console.log(videoMsg);

    // 获取路由参数
    let url = decodeURI(window.location.href);
    let argsIndex = url.split("?name=");
    let arg = argsIndex[1];
    // console.log(arg);

    const video = my$("video");
    const heading = my$("heading");

    // 新建临时数组存放数据
    let dataObj = {};
    for (let i = 0; i < videoMsg.length; i++) {
        if (arg === videoMsg[i].title) {
            dataObj = videoMsg[i];
        }
    }

    let video_src = '../01 热门电影合集/[' + dataObj.year + "年] " + dataObj.title + '/' + dataObj.year + " " + dataObj.title + dataObj.type;
    let video_poster = './img/video/' + dataObj.title + '.jpg';

    video.src = video_src;
    video.poster = video_poster;
    heading.innerHTML = dataObj.title;

    //更新播放进度
    video.addEventListener("timeupdate", function () {
        //显示当前播放进度的时间
        document.querySelector(".current").innerText = getTimeBySecond(video.currentTime);
    });

    //当视频元数据加载时运行
    video.addEventListener("loadedmetadata", function () {
        //设置总时长
        document.querySelector(".totalTime").innerText = getTimeBySecond(video.duration);
    });

    //js  快退
    $(document).keydown(function (event) {
        if (event.keyCode === 37) {
            console.log("左方向键");
            if (video.currentTime > 5) {
                video.currentTime -= 5;
            } else {
                video.currentTime = 0;
            }
            document.querySelector(".current").innerText = getTimeBySecond(video.currentTime);
        }
        if (event.keyCode === 39) {
            console.log("右方向键");
            if (video.currentTime < video.duration - 5) {
                video.currentTime += 5;
            } else {
                video.currentTime = video.duration;
            }
            document.querySelector(".current").innerText = getTimeBySecond(video.currentTime);
        }
        if (event.keyCode === 32) {
            console.log("空格");
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }
    });
</script>

<script>
    (function (window) {
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let canvasW = window.innerWidth;
        let canvasH = window.innerHeight;
        let particles = [];
        let maxParticles = 500;

        let random = function (min, max) {
            return Math.random() * (max - min) + min
        };

        window.requestAnimationFrame = (function () {
            let FPS = 60;

            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (callBack) {
                    window.setTimeout(callBack, 1000 / FPS)
                }
        })();

        let Particle = function () {
            this.x = Math.random() * canvasW;
            this.y = Math.random() * canvasH;
            this.r = random(1, 5);
            this.alpha = random(0.3, 1);
            this.velocity = {
                x: random(-0.35, 0.35),
                y: random(0.75, 1.5)
            };

            this.draw = function () {
                ctx.fillStyle = 'rgba(255, 255, 255, ' + this.alpha + ')';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, 2 * Math.PI, false);
                ctx.closePath();
                ctx.fill()
            };

            this.moving = function () {
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                if (this.y > canvasH) {
                    this.x = Math.random() * canvasW;
                    this.y = 0
                }

                this.draw()
            }
        };

        init();

        function init() {
            canvas.width = canvasW;
            canvas.height = canvasH;

            for (let i = 0; i < maxParticles; i++) {
                particles.push(new Particle())
            }

            animate()
        }

        function animate() {
            ctx.clearRect(0, 0, canvasW, canvasH);
            particles.forEach(function (particle) {
                particle.moving()
            });

            requestAnimationFrame(animate)
        }
    })(window)
</script>
</body>
</html>
